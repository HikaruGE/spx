module templatelang-to-str-2

language SpoofaxLang
target language Stratego-Sugar

// FIXME: This testsuite should really eval the generated stratego code on sample
//        input, instead of testing the exact form of the generated stratego code.
//        This is currently not really possible, however ...

// TODO: All tests are now equal, remove the duplicates?

setup common input [[
  package example
  module example
  templates
    Statement.IfThen = <<
      <MetaAnno*; separator="\n">
      if <Exp> then
        <Statement*; separator="\n">
      end
    >>
]]

target setup header [[
  module prettyprinter
  imports
    libstratego-lib
  strategies
    pp-option(s) = \None() -> ""\ + \Some(t) -> <s> t\
    pp-list(s|t) = map(s); separate-by(|t); concat-strings
    pp-guarantee-newline = string-ends-with(|"\n") <+ <conc-strings> (<id>, "\n")
    pp-ih(|t) = ?"" <+ prefix-lines(|t); pp-guarantee-newline
  strategies
]]

test no newlines [[
  template options
    newlines : none
]]
build test-templatelang-to-str to [[
  prettyprint-Statement: IfThen(a, b, c) -> zz
    with
      a' := <pp-list(prettyprint-MetaAnno|"\n")> a;
      b' := <prettyprint-Exp> b;
      c' := <pp-list(prettyprint-Statement|"\n")> c;
      zz := <concat-strings> [<pp-ih(|"")> a', "if ", b', " then\n", <pp-ih(|"  ")> c', "end"]
]]

test leading newlines [[
  template options
    newlines : leading
]]
build test-templatelang-to-str to [[
  prettyprint-Statement: IfThen(a, b, c) -> zz
    with
      a' := <pp-list(prettyprint-MetaAnno|"\n")> a;
      b' := <prettyprint-Exp> b;
      c' := <pp-list(prettyprint-Statement|"\n")> c;
      zz := <concat-strings> [<pp-ih(|"")> a', "if ", b', " then\n", <pp-ih(|"  ")> c', "end"]
]]

test trailing newlines [[
  template options
    newlines : trailing
]]
build test-templatelang-to-str to [[
  prettyprint-Statement: IfThen(a, b, c) -> zz
    with
      a' := <pp-list(prettyprint-MetaAnno|"\n")> a;
      b' := <prettyprint-Exp> b;
      c' := <pp-list(prettyprint-Statement|"\n")> c;
      zz := <concat-strings> [<pp-ih(|"")> a', "if ", b', " then\n", <pp-ih(|"  ")> c', "end"]   
]]

target setup footer [[
  strategies
    prettyprint-MetaAnno = is-string
    prettyprint-Exp = is-string
]]
